(()=>{"use strict";var e,o,t={},n=null;function l(e){console.log("INSIDE "),console.log("SITE DATA:",e);var o=e.accumulatedTime||0;return e.time-o}function s(e,n,l){console.log("INSIDE START TIMER METHOD"),t[n]&&clearTimeout(t[n]),chrome.storage.local.get("sites",(function(o){var t=o.sites||{};(t[e]||{}).startTime=Date.now(),chrome.storage.local.set({sites:t})})),t[n]=setTimeout((function(){!function(e,o,n){console.log("HANDLE TIME LIMIT REACHED"),console.log("TIMERS:",t[n]),t[n]&&(E(e),r(e,o,n))}(e,o,n)}),1e3*l)}function c(e){var o=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");return"^".concat(o,".*$")}function r(e,o,t){console.log("REDIRECT TO BLOCKED PAGE CALLED");var n={url:e,message:o};chrome.storage.local.set({blockedSite:n},(function(){chrome.tabs.update(t,{url:chrome.runtime.getURL("blocked.html")})}))}function a(e){console.log("UPDATE TOTAL VISITS CALLED ON:",e),chrome.storage.local.get("sites",(function(o){var t=o.sites||{};t[e]&&(t[e].totalVisits=(t[e].totalVisits||0)+1,chrome.storage.local.set({sites:t}))}))}function i(e){return o=this,t=void 0,l=function(){return function(e,o){var t,n,l,s,c={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(r){return function(a){return function(r){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,r[0]&&(c=0)),c;)try{if(t=1,n&&(l=2&r[0]?n.return:r[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,r[1])).done)return l;switch(n=0,l&&(r=[2&r[0],l.value]),r[0]){case 0:case 1:l=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,n=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(!((l=(l=c.trys).length>0&&l[l.length-1])||6!==r[0]&&2!==r[0])){c=0;continue}if(3===r[0]&&(!l||r[1]>l[0]&&r[1]<l[3])){c.label=r[1];break}if(6===r[0]&&c.label<l[1]){c.label=l[1],l=r;break}if(l&&c.label<l[2]){c.label=l[2],c.ops.push(r);break}l[2]&&c.ops.pop(),c.trys.pop();continue}r=o.call(e,c)}catch(e){r=[6,e],n=0}finally{t=l=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,(function(o){return[2,new Promise((function(o,t){chrome.storage.local.get("sites",(function(t){var n=t.sites||{};console.log("SITES IN FIND MATCHING SITE:",n);var l=Object.keys(n);if(console.log("SITE KEYS:",l),0===l.length)return console.log("No sites found in storage."),void o(null);for(var s=0,r=l;s<r.length;s++){var a=r[s];if(a){var i=n[a];if(new RegExp(i.pattern||c(a)).test(e))return void o(a)}}o(null)}))}))]}))},new((n=void 0)||(n=Promise))((function(e,s){function c(e){try{a(l.next(e))}catch(e){s(e)}}function r(e){try{a(l.throw(e))}catch(e){s(e)}}function a(o){var t;o.done?e(o.value):(t=o.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,r)}a((l=l.apply(o,t||[])).next())}));var o,t,n,l}function E(e){console.log("UPDATE BLOCKED STATUS CALLED ON:",e),chrome.storage.local.get("sites",(function(o){var t=o.sites||{};t[e]&&(t[e].blocked=!0,chrome.storage.local.set({sites:t}))}))}function u(o){console.log("UPDATE ACCUMULATED TIME"),chrome.storage.local.get("sites",(function(o){if(e&&o.sites[e]){var t=o.sites[e],n=Date.now(),l=t.startTime?(n-t.startTime)/1e3:0;console.log("ELAPSED TIMES:",l),t.accumulatedTime=(t.accumulatedTime||0)+l,chrome.storage.local.set({sites:o.sites})}}))}chrome.webNavigation.onBeforeNavigate.addListener((function(t){console.log("INSIDE ON BEFFORE NAV"),0===t.frameId&&t.url&&(console.log("INSIDE BEFORE NAV IF STATEMENT"),i(t.url).then((function(l){console.log("INSIDE FIND MATCHING SITE THEN"),l&&(console.log("INSIDE MATCH SITE IF STATEMENT"),chrome.storage.local.get("sites",(function(s){var i=s.sites[l];e=l,o=i.message,n=new RegExp(i.pattern||c(l)),i.blocked&&(console.log("INSIDE SITE DATA BLOCKED"),a(l),r(l,o,t.tabId))})))})))}),{url:[{schemes:["http","https"]}]}),chrome.webNavigation.onCompleted.addListener((function(t){console.log("INSIDE ON COMPLETED"),0===t.frameId&&t.url&&(console.log("INSIDE ON COMPLETED FIRST IF"),i(t.url).then((function(i){console.log("INSIDE FIND MATCHING SITE THEN"),console.log("MATCHED SITE ON COMPLETE:",i),i&&(console.log("INSIDE MATCHED SITE IF"),chrome.storage.local.get("sites",(function(u){var I=u.sites[i];if(e=i,o=I.message,n=new RegExp(I.pattern||c(i)),I.blocked)console.log("ON COMPLETED BLOCKED IF STATEMENT"),a(i),r(i,o,t.tabId);else{console.log("ON COMPLTED ELSE MAIN");var T=l(I);T<=0?(console.log("INSIDE ON COMPLETED REMAINING TIME LESS THAN OR EQUAL TO 0"),E(i),r(i,o,t.tabId)):(console.log("INSIDE ELSE STATEMENT - CALL START TIMER"),s(i,t.tabId,T))}})))})))}),{url:[{schemes:["http","https"]}]}),chrome.tabs.onActivated.addListener((function(a){console.log("INSIDE ON ACTIVATED"),a.tabId&&chrome.tabs.get(a.tabId,(function(E){E&&E.url&&i(E.url).then((function(i){i?chrome.storage.local.get("sites",(function(t){var u=t.sites[i];e=i,o=u.message,n=new RegExp(u.pattern||c(i)),console.log("URL INSIDE ACTIVATED:",E.url),console.log("PATTERN INSIDE ON ACTIVATED:",n),u.blocked?r(i,o,a.tabId):s(i,a.tabId,l(u))})):t[a.tabId]&&(e="",n=null,o="",clearTimeout(t[a.tabId]),u(a.tabId),delete t[a.tabId])}))}))})),chrome.tabs.onRemoved.addListener((function(l){console.log("INSIDE ON REMOVED"),t[l]&&(console.log("INSIDE ON REMOVED IF STATEMENT"),e="",n=null,o="",clearTimeout(t[l]),u(),delete t[l])}))})();