(()=>{"use strict";var e,o,t={};function s(e){Date.now(),console.log("SITE DATA:",e);var o=e.accumulatedTime||0;return e.time-o}function l(e,s,l){console.log("INSIDE START TIMER METHOD"),t[s]&&clearTimeout(t[s]),chrome.storage.local.get("sites",(function(o){var t=o.sites||{};(t[e]||{}).startTime=Date.now(),chrome.storage.local.set({sites:t})}));var a=60*l*1e3;t[s]=setTimeout((function(){!function(e,o,s){console.log("HANDLE TIME LIMIT REACHED"),console.log("TIMERS:",t[s]),t[s]&&(i(e),c(e,o,s))}(e,o,s)}),a)}function c(e,o,t){console.log("REDIRECT TO BLOCKED PAGE CALLED");var s={url:e,message:o};chrome.storage.local.set({blockedSite:s},(function(){chrome.tabs.update(t,{url:chrome.runtime.getURL("blocked.html")})}))}function a(e){console.log("UPDATE TOTAL VISITS CALLED ON:",e),chrome.storage.local.get("sites",(function(o){var t=o.sites||{};t[e]&&(t[e].totalVisits=(t[e].totalVisits||0)+1,chrome.storage.local.set({sites:t}))}))}function i(e){console.log("UPDATE BLOCKED STATUS CALLED ON:",e),chrome.storage.local.get("sites",(function(o){var t=o.sites||{};t[e]&&(t[e].blocked=!0,chrome.storage.local.set({sites:t}))}))}function r(o){console.log("UPDATE ACCUMULATED TIME"),chrome.storage.local.get("sites",(function(o){if(e&&o.sites[e]){var t=o.sites[e],s=Date.now(),l=t.startTime?(s-t.startTime)/1e3:0;console.log("ELAPSED TIMES:",l),t.accumulatedTime=(t.accumulatedTime||0)+l,t.startTime=void 0,chrome.storage.local.set({sites:o.sites})}}))}chrome.webNavigation.onBeforeNavigate.addListener((function(t){0===t.frameId&&chrome.storage.local.get("sites",(function(s){if(console.log("BEFORE IF STATEMENT"),s.sites&&s.sites[t.url]){var l=s.sites[t.url];e=t.url,o=l.message,console.log("CURRENT SITE IN BEFORE NAVIGATE:",e),l.blocked&&(console.log("INSIDE FIRST IF - SITE BLOCKED (BEFORE NAVIGATE)"),a(t.url),c(t.url,o,t.tabId))}}))}),{url:[{schemes:["http","https"]}]}),chrome.webNavigation.onCompleted.addListener((function(t){console.log("INSIDE ON COMPLETED"),0===t.frameId&&chrome.storage.local.get("sites",(function(r){if(console.log("BEFORE IF STATEMENT"),r.sites&&r.sites[t.url]){var n=r.sites[t.url];if(e=t.url,o=n.message,console.log("CURRENT SITE:",e),n.blocked)console.log("INSIDE FIRST IF - SITE BLOCKED"),a(t.url),c(t.url,o,t.tabId);else{console.log("INSIDE ELSE IF - SITE NOT BLOCKED");var E=s(n);console.log("REMAINING TIME:",E),E<=0?(i(t.url),c(t.url,o,t.tabId)):l(t.url,t.tabId,E)}}}))}),{url:[{schemes:["http","https"]}]}),chrome.tabs.onActivated.addListener((function(o){console.log("INSIDE ON ACTIVATED"),o.tabId&&e&&chrome.tabs.get(o.tabId,(function(c){c&&c.url===e?chrome.storage.local.get("sites",(function(t){var c=t.sites||{};c[e]&&l(e,o.tabId,s(c[e]))})):t[o.tabId]&&(e="",clearTimeout(t[o.tabId]),r(o.tabId),delete t[o.tabId])}))})),chrome.tabs.onRemoved.addListener((function(o){console.log("INSIDE ON REMOVED"),t[o]&&(console.log("INSIDE ON REMOVED IF STATEMENT"),e="",clearTimeout(t[o]),r(),delete t[o])}))})();